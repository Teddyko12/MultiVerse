import discord
from discord import app_commands
from discord.ext import commands
import random
import os

# --- рЃЉрЃЮрЃбрЃўрЃА рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ ---
TOKEN = 'рЃерЃћрЃюрЃў_рЃЉрЃЮрЃбрЃўрЃА_рЃбрЃЮрЃЎрЃћрЃюрЃў' # рЃљрЃЦ рЃЕрЃљрЃАрЃЋрЃў рЃерЃћрЃюрЃў рЃбрЃЮрЃЎрЃћрЃюрЃў

class MafiaBot(commands.Bot):
    def __init__(self):
        intents = discord.Intents.default()
        intents.members = True  # рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃгрЃћрЃЋрЃарЃћрЃЉрЃўрЃА рЃАрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА
        intents.message_content = True
        super().__init__(command_prefix="!", intents=intents)

    async def setup_hook(self):
        # рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃўрЃА рЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃўрЃќрЃљрЃфрЃўрЃљ Discord-рЃЌрЃљрЃю
        await self.tree.sync()
        print(f"Logged in as {self.user} | Commands Synced")

bot = MafiaBot()

# --- рЃарЃЮрЃџрЃћрЃЉрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ ---
def get_roles_distribution(count):
    # рЃерЃћрЃюрЃў рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃџрЃў рЃцрЃЮрЃарЃЏрЃБрЃџрЃљ:
    if count == 6: 
        return ["рЃЏрЃљрЃцрЃўрЃљ", "рЃћрЃЦрЃўрЃЏрЃў", "рЃЊрЃћрЃбрЃћрЃЦрЃбрЃўрЃЋрЃў"] + ["рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ"] * 3
    elif count == 7: 
        return ["рЃЏрЃљрЃцрЃўрЃљ", "рЃћрЃЦрЃўрЃЏрЃў", "рЃЊрЃћрЃбрЃћрЃЦрЃбрЃўрЃЋрЃў"] + ["рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ"] * 4
    elif count == 8: 
        return ["рЃЏрЃљрЃцрЃўрЃљ", "рЃЏрЃљрЃцрЃўрЃљ", "рЃћрЃЦрЃўрЃЏрЃў", "рЃЊрЃћрЃбрЃћрЃЦрЃбрЃўрЃЋрЃў"] + ["рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ"] * 4
    elif count == 9: 
        return ["рЃЏрЃљрЃцрЃўрЃљ", "рЃЏрЃљрЃцрЃўрЃљ", "рЃћрЃЦрЃўрЃЏрЃў", "рЃЊрЃћрЃбрЃћрЃЦрЃбрЃўрЃЋрЃў"] + ["рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ"] * 5
    elif count == 10: 
        return ["рЃЏрЃљрЃцрЃўрЃљ", "рЃЏрЃљрЃцрЃўрЃљ", "рЃћрЃЦрЃўрЃЏрЃў", "рЃЊрЃћрЃбрЃћрЃЦрЃбрЃўрЃЋрЃў", "рЃАрЃћрЃарЃўрЃБрЃџрЃў рЃЏрЃЎрЃЋрЃџрЃћрЃџрЃў"] + ["рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ"] * 5
    elif count == 11: 
        return ["рЃЏрЃљрЃцрЃўрЃљ", "рЃЏрЃљрЃцрЃўрЃљ", "рЃЏрЃљрЃцрЃўрЃљ", "рЃћрЃЦрЃўрЃЏрЃў", "рЃЊрЃћрЃбрЃћрЃЦрЃбрЃўрЃЋрЃў", "рЃАрЃћрЃарЃўрЃБрЃџрЃў рЃЏрЃЎрЃЋрЃџрЃћрЃџрЃў"] + ["рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ"] * 5
    return None

# --- рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃфрЃўрЃБрЃџрЃў рЃЏрЃћрЃюрЃўрЃБ ---
class PlayerSelect(discord.ui.UserSelect):
    def __init__(self):
        # рЃЏрЃўрЃюрЃўрЃЏрЃБрЃЏ 6, рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃБрЃЏ 11 рЃЏрЃЮрЃЌрЃљрЃЏрЃљрЃерЃћ
        super().__init__(placeholder="рЃљрЃўрЃарЃЕрЃўрЃћ рЃЏрЃЮрЃЌрЃљрЃЏрЃљрЃерЃћрЃћрЃЉрЃў (6-11)", min_values=6, max_values=11)

    async def callback(self, interaction: discord.Interaction):
        players = self.values
        roles = get_roles_distribution(len(players))
        
        if roles is None:
            await interaction.response.send_message("рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ: рЃЏрЃЮрЃЌрЃљрЃЏрЃљрЃерЃћрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА 6-11!", ephemeral=True)
            return

        random.shuffle(roles)
        game_data = list(zip(players, roles))
        
        # рЃљрЃЊрЃЏрЃўрЃюрЃўрЃА рЃљрЃюрЃњрЃљрЃарЃўрЃерЃў (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃА рЃЊрЃљрЃўрЃюрЃљрЃ«рЃљрЃЋрЃА)
        admin_report = "­Ъј« **рЃЌрЃљрЃЏрЃљрЃерЃў рЃЊрЃљрЃўрЃгрЃДрЃЮ! рЃарЃЮрЃџрЃћрЃЉрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃАрЃўрЃљ:**\n"
        admin_report += "-------------------------------------\n"

        await interaction.response.send_message("­Ъј▓ рЃарЃЮрЃџрЃћрЃЉрЃў рЃЊрЃљрЃарЃўрЃњрЃћрЃЉрЃБрЃџрЃўрЃљ! рЃЏрЃЮрЃЌрЃљрЃЏрЃљрЃерЃћрЃћрЃЉрЃЏрЃљ рЃЏрЃўрЃўрЃдрЃћрЃА рЃърЃўрЃарЃљрЃЊрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃћрЃЉрЃў.", ephemeral=True)

        for player, role in game_data:
            admin_report += f"­ЪЉц {player.display_name} Рђћ> **{role}**\n"
            
            # рЃърЃўрЃарЃљрЃЊрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃљ
            try:
                msg = (f"РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ\n"
                       f"­ЪЈ░ **MultiVerse Community Mafia**\n"
                       f"РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ\n"
                       f"рЃАрЃљрЃџрЃљрЃЏрЃў, рЃерЃћрЃюрЃў рЃарЃЮрЃџрЃў рЃљрЃарЃўрЃА: **{role}**\n"
                       f"рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃБрЃџ рЃЌрЃљрЃЏрЃљрЃерЃА рЃњрЃўрЃАрЃБрЃарЃЋрЃћрЃЉ <3\n"
                       f"РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ")
                await player.send(msg)
            except discord.Forbidden:
                admin_report += f"Рџа№ИЈ **рЃЋрЃћрЃа рЃЏрЃўрЃЋрЃгрЃћрЃарЃћ:** {player.display_name} (DM рЃЊрЃљрЃЎрЃћрЃбрЃўрЃџрЃў рЃљрЃЦрЃЋрЃА)\n"

        # рЃљрЃЊрЃЏрЃўрЃюрЃА рЃЋрЃБрЃњрЃќрЃљрЃЋрЃюрЃўрЃЌ рЃАрЃарЃБрЃџ рЃАрЃўрЃљрЃА (ephemeral=True рЃюрЃўрЃерЃюрЃљрЃЋрЃА рЃарЃЮрЃЏ рЃАрЃ«рЃЋрЃћрЃЉрЃў рЃЋрЃћрЃа рЃ«рЃћрЃЊрЃљрЃЋрЃћрЃю)
        await interaction.followup.send(admin_report, ephemeral=True)

class GameView(discord.ui.View):
    def __init__(self):
        super().__init__()
        self.add_item(PlayerSelect())

# --- рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃў ---

@bot.tree.command(name="dawyeba", description="рЃЏрЃљрЃцрЃўрЃўрЃА рЃЌрЃљрЃЏрЃљрЃерЃўрЃА рЃЊрЃљрЃгрЃДрЃћрЃЉрЃљ рЃЊрЃљ рЃарЃЮрЃџрЃћрЃЉрЃўрЃА рЃЊрЃљрЃарЃўрЃњрЃћрЃЉрЃљ")
async def dawyeba(interaction: discord.Interaction):
    view = GameView()
    await interaction.response.send_message("рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃЏрЃЮрЃЌрЃљрЃЏрЃљрЃерЃћрЃћрЃЉрЃў, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃЏрЃЮрЃюрЃљрЃгрЃўрЃџрЃћрЃЮрЃЉрЃћрЃю рЃљрЃЏ рЃарЃљрЃБрЃюрЃЊрЃерЃў:", view=view, ephemeral=True)

@bot.tree.command(name="test_dm", description="рЃърЃўрЃарЃљрЃЊрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃбрЃћрЃАрЃбрЃў")
async def test_dm(interaction: discord.Interaction):
    """рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃЉрЃЮрЃбрЃўрЃА рЃЏрЃўрЃћрЃа рЃЏрЃЮрЃЌрЃљрЃЏрЃљрЃерЃўрЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃўрЃџ рЃцрЃЮрЃарЃЏрЃљрЃбрЃА"""
    try:
        test_msg = (f"РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ\n"
                    f"­ЪЈ░ **MultiVerse Community Mafia (рЃбрЃћрЃАрЃбрЃў)**\n"
                    f"РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ\n"
                    f"рЃАрЃљрЃџрЃљрЃЏрЃў, рЃерЃћрЃюрЃў рЃарЃЮрЃџрЃў рЃљрЃарЃўрЃА: **рЃЏрЃЮрЃЦрЃљрЃџрЃљрЃЦрЃћ (рЃбрЃћрЃАрЃбрЃў)**\n"
                    f"рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃБрЃџ рЃЌрЃљрЃЏрЃљрЃерЃА рЃњрЃўрЃАрЃБрЃарЃЋрЃћрЃЉ <3\n"
                    f"РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ")
        await interaction.user.send(test_msg)
        await interaction.response.send_message("РюЁ рЃбрЃћрЃАрЃбрЃў рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃБрЃџрЃўрЃљ! рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃърЃўрЃарЃљрЃЊрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљ.", ephemeral=True)
    except discord.Forbidden:
        await interaction.response.send_message("РЮї рЃЋрЃћрЃа рЃЏрЃЮрЃњрЃгрЃћрЃарЃћ! рЃЕрЃљрЃарЃЌрЃћ 'Allow direct messages' рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃўрЃЊрЃљрЃю.", ephemeral=True)

@bot.tree.command(name="test_chat", description="рЃЕрЃљрЃбрЃерЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЕрЃћрЃюрЃўрЃА рЃбрЃћрЃАрЃбрЃў")
async def test_chat(interaction: discord.Interaction):
    await interaction.response.send_message("РюЁ рЃЉрЃЮрЃбрЃў рЃЎрЃљрЃЋрЃерЃўрЃарЃќрЃћрЃљ рЃЊрЃљ рЃЏрЃќрЃљрЃЊ рЃљрЃарЃўрЃА рЃЌрЃљрЃЏрЃљрЃерЃўрЃАрЃЌрЃЋрЃўрЃА!")

# рЃЉрЃЮрЃбрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ
bot.run(TOKEN)
